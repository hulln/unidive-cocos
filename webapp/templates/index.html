<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Backchannel Candidates Viewer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header>
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px;">
                <h1>üéôÔ∏è Backchannel Candidates</h1>
                <div id="user-section" class="user-section">
                    <div id="user-login" style="display: flex; gap: 10px; align-items: center;">
                        <input type="text" id="user-name-input" placeholder="Enter your name" style="padding: 8px 12px; border-radius: 6px; border: 2px solid #667eea;" onkeypress="if(event.key === 'Enter') setUserName()">
                        <button onclick="setUserName()" class="btn-primary" style="padding: 8px 16px;">Start Annotating</button>
                    </div>
                    <div id="user-info" style="display: none;">
                        <span style="font-weight: 600; color: #667eea;">üë§ <span id="current-user"></span></span>
                        <span style="margin: 0 10px; color: #9ca3af;">|</span>
                        <div class="progress-container">
                            <div class="progress-info">
                                <span class="progress-label">Progress:</span>
                                <span class="progress-text"><strong id="user-annotation-count">0</strong> / <span id="total-candidates-count">0</span></span>
                                <span class="progress-percent" id="progress-percent">0%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                            </div>
                        </div>
                        <div class="user-actions">
                            <button onclick="clearAllAnnotations()" class="btn-secondary" title="Remove all your annotations">Clear All</button>
                            <button onclick="exportAnnotations()" class="btn-primary">Export CSV</button>
                            <button onclick="logoutUser()" class="btn-secondary">Logout</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="stats" id="stats">
                <div class="stat">
                    <span class="stat-label">Total</span>
                    <span class="stat-value" id="stat-total">-</span>
                </div>
                <div class="stat stat-high">
                    <span class="stat-label">HIGH</span>
                    <span class="stat-value" id="stat-high">-</span>
                </div>
                <div class="stat stat-medium">
                    <span class="stat-label">MEDIUM</span>
                    <span class="stat-value" id="stat-medium">-</span>
                </div>
                <div class="stat stat-low">
                    <span class="stat-label">LOW</span>
                    <span class="stat-value" id="stat-low">-</span>
                </div>
            </div>
        </header>

        <!-- Filters -->
        <div class="filters">
            <!-- Basic Filters -->
            <div class="filters-section filters-basic">
                <div class="filters-row">
                    <select id="filter-confidence" title="Filter by confidence level: HIGH (best backchannels), MEDIUM (good with warnings), LOW (questionable)">
                        <option value="">All quality levels</option>
                        <option value="HIGH">HIGH</option>
                        <option value="MEDIUM">MEDIUM</option>
                        <option value="LOW">LOW</option>
                    </select>
                    
                    <select id="filter-sort" title="Sort candidates by score or length">
                        <option value="">Sort by...</option>
                        <option value="score_desc">Score ‚Üì</option>
                        <option value="score_asc">Score ‚Üë</option>
                        <option value="tokens_asc">Length ‚Üë</option>
                        <option value="tokens_desc">Length ‚Üì</option>
                    </select>

                    <select id="filter-continuation" title="Does speaker A continue talking after B's utterance? Immediate continuation = strongest evidence B is backchannel">
                        <option value="">All continuations</option>
                        <option value="immediate">Immediate</option>
                        <option value="windowed">Windowed</option>
                        <option value="none">None</option>
                    </select>

                    <select id="filter-category" title="Filter by backchannel category: continuer, agreement, understanding, assessment, or filler">
                        <option value="">Category: All</option>
                    </select>

                    <select id="filter-annotated" style="display: none;" title="Show, hide, or only show annotated candidates">
                        <option value="all">All candidates</option>
                        <option value="hide">Hide annotated</option>
                        <option value="only">Only annotated</option>
                    </select>
                </div>

                <div class="filters-row">
                    <select id="filter-has-content" title="Does B contain content words (verbs, nouns, adjectives)? Backchannels should be simple particles without content words">
                        <option value="">Content words: any</option>
                        <option value="0">No content words ‚úì</option>
                        <option value="1">Has content words ‚ö†</option>
                    </select>

                    <select id="filter-is-question" title="Is B a multi-token question? Questions are typically not backchannels">
                        <option value="">Is question: any</option>
                        <option value="0">Not question ‚úì</option>
                        <option value="1">Is question ‚ö†</option>
                    </select>

                    <select id="filter-after-question" title="Does B come after A asked a question? If yes, B might be an answer rather than backchannel">
                        <option value="">After question: any</option>
                        <option value="0">Not after question ‚úì</option>
                        <option value="1">After question ‚ö†</option>
                    </select>

                    <select id="filter-a-backchannel" title="Does A (the previous utterance) look like a backchannel itself? If yes, the direction might be wrong">
                        <option value="">A is backchannel: any</option>
                        <option value="0">A not backchannel ‚úì</option>
                        <option value="1">A is backchannel ‚ö†</option>
                    </select>

                    <input type="text" id="filter-search" placeholder="Search text..." style="width: 130px;" title="Search for specific words in the A or B utterance text">

                    <button id="btn-toggle-advanced" class="btn-toggle-advanced" onclick="toggleAdvancedFilters()" title="Show/hide advanced filters">
                        <span class="toggle-icon">‚ñ∂</span> Advanced
                    </button>

                    <button id="btn-reset" class="btn-secondary" title="Clear all filters and show all candidates">Reset</button>
                    <button id="btn-export" class="btn-primary" title="Download currently filtered candidates as CSV file">Export CSV</button>
                </div>
            </div>

            <!-- Advanced Filters (collapsible) -->
            <div class="filters-section filters-advanced" id="advanced-filters" style="display: none;">
                <div class="filters-row">
                    <span class="filter-label">Tokens:</span>
                    <input type="number" id="filter-min-tokens" placeholder="Min" min="1" style="width: 70px;" title="Minimum number of tokens in B (the backchannel candidate). Ideal: 1-3">
                    <span class="filter-separator">-</span>
                    <input type="number" id="filter-max-tokens" placeholder="Max" max="20" style="width: 70px;" title="Maximum number of tokens in B (the backchannel candidate). Ideal: 1-3">

                    <span class="filter-label" style="margin-left: 15px;">Score:</span>
                    <input type="number" id="filter-min-score" placeholder="Min" min="0" max="100" style="width: 70px;" title="Minimum confidence score (0-100). Higher = more confident backchannel">
                    <span class="filter-separator">-</span>
                    <input type="number" id="filter-max-score" placeholder="Max" min="0" max="100" style="width: 70px;" title="Maximum confidence score (0-100). Higher = more confident backchannel">

                    <select id="filter-lexicon" title="Filter by lexicon word">
                        <option value="">Lexicon word: All</option>
                    </select>

                    <select id="filter-doc" title="Filter by specific document ID. Select 'All' to see all documents">
                        <option value="">Document: All</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Results count -->
        <div class="results-info">
            <span id="results-count">Loading...</span>
        </div>

        <!-- Candidates list -->
        <div id="candidates-list" class="candidates-list">
            <div class="loading">Loading candidates...</div>
        </div>

        <!-- Pagination -->
        <div class="pagination" id="pagination" style="display: none;">
            <button id="btn-first" class="pagination-btn" onclick="firstPage()" title="First page">¬´</button>
            <button id="btn-prev" class="pagination-btn" onclick="previousPage()" title="Previous page">‚Äπ</button>
            <span class="pagination-info">
                Page <span id="current-page">1</span> of <span id="total-pages">1</span>
            </span>
            <button id="btn-next" class="pagination-btn" onclick="nextPage()" title="Next page">‚Ä∫</button>
            <button id="btn-last" class="pagination-btn" onclick="lastPage()" title="Last page">¬ª</button>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
